<script is:inline>
  console.log("GLOBAL QUOTE FORM HANDLER LOADED");

  document.addEventListener("DOMContentLoaded", () => {
    // Bind to ALL quote forms (contact + footer)
    const forms = document.querySelectorAll('form.kl-quoteform__grid[action="/api/quote"][method="POST"]');

    forms.forEach((form) => {
      // prevent double-binding
      if (form.dataset.klBound === "1") return;
      form.dataset.klBound = "1";

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        // Clear honeypot (avoids autofill triggering spam)
        const hp = form.querySelector('input[name="website"]');
        if (hp) hp.value = "";

        try {
          const res = await fetch("/api/quote", {
            method: "POST",
            headers: { Accept: "application/json" },
            body: new FormData(form),
          });

          const data = await res.json().catch(() => ({}));

          if (res.ok && data.ok === true) {
            window.location.href = "/thank-you/";
            return;
          }

          console.log("QUOTE API RESPONSE:", res.status, data);
          alert("Not sent. Please try again.");
        } catch (err) {
          console.log("Network error:", err);
          alert("Network error. Please try again.");
        }
      });
    });
  });
</script>
